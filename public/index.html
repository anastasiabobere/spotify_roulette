<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content=" Anastasia Bobere" />
    <meta name="description" content="Spotify Api roulette game" />
    <meta name="keywords" content="Spotify WEB API Game roulette" />
    <script
      src="https://kit.fontawesome.com/1995a9df69.js"
      crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/bg.css" />
    <link rel="stylesheet" href="css/main.css" />
    <title>Spotify roulette</title>
  </head>
  <body>
    <section id="home">
      <h1>Welcome to Spotify Roulette</h1>

      <div class="buttons">
        <button class="btn-blue" onclick="joinRoom()">Join Room</button>
        <button class="btn-green" onclick="createRoom()">Create Room</button>
        <button id="login" class="btn-blue">
          <a href="/login">Login with Spotify</a>
        </button>
      </div>
      <div class="bubble-how">
        <h2>How to play?</h2>
        <p>
          When at least 4 people joined the game can get started, while playing
          you will be shown random songs from top listened and you have to guess
          who listened to this in the last week ! Simple as that
        </p>
      </div>

      <div class="bubble-name">
        <h2>Made by Anastasia Bobere</h2>
      </div>
      <div class="bubble-contact">
        <h3>
          <a
            href="https://anastasiabobere.github.io/anastasia-contact/"
            target="_blank"
            >Contact Me</a
          >
        </h3>
      </div>
    </section>
    <div class="background">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <button onclick="window.location.href='/login';">Login to Spotify</button>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script src="js/script.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script>
      // function getHashParams() {
      //   let hashParams = {};
      //   let e,
      //     r = /([^&;=]+)=?([^&;]*)/g, // really weird looking way to include all characters
      //     q = window.location.hash.substring(1);
      //   while ((e = r.exec(q))) {
      //     hashParams[e[1]] = decodeURIComponent(e[2]);
      //   }
      //   return hashParams;
      // }

      // let params = getHashParams();

      // let access_token = params.access_token;
      // let refresh_token = params.refresh_token;
      // let error = params.error;

      // if (error) {
      //   alert("There was an error during the authentication");
      // } else {
      //   if (access_token) {
      //     $("#login").hide(); // change to login screen by hiding matching divs
      //     $("#logged-in").show(); // but only if the login was successful
      //   } else {
      //     $("#login").show();
      //     $("#logged-in").hide();
      //   }
      // }

      // document.getElementById("refresh-token").addEventListener(
      //   "click",
      //   function () {
      //     $.ajax({
      //       url: "/refresh_token", // there are better ways to implement a refresh than this - but this is how you'd do it
      //       data: {
      //         "refresh_token": refresh_token,
      //       },
      //     }).done(function (data) {
      //       access_token = data.access_token;
      //       console.log(`new access token: ${access_token}`);
      //     });
      //   },
      //   false,
      // );
      window.onload = () => {
        const hash = window.location.hash;
        if (hash) {
          const params = new URLSearchParams(hash.substring(1));
          const accessToken = params.get("access_token");
          const refreshToken = params.get("refresh_token");
          const error = params.get("error");

          if (accessToken) {
            console.log("Access Token:", accessToken);
            console.log("Refresh Token:", refreshToken);
            // Store the tokens (e.g., in local storage) and use them to make API calls
          } else if (error) {
            console.error("Spotify Error:", error);
          }

          // Remove the hash from the URL
          window.location.hash = "";
        }
      };
    </script>
  </body>
</html>
